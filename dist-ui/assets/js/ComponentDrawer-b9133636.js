import{d as L,a as Z,r as m,S as ee,b as n,a3 as ne,c as _,t as S,w as t,f as e,U as O,V as se,j as $,E as A,e as B,g as D,u as P,O as ue,D as J,B as ve,F as K,M as Q,X as W,a4 as Y,_ as we,a5 as ge}from"./index-0dd33b3d.js";import{g as ie,i as be,j as re,k as Ve,d as ye,l as he}from"./components-3024ebe5.js";import{n as De}from"./util-29963aac.js";import{_ as Ce}from"./FootprintDrawer-57ebfb14.js";import{_ as ke}from"./StorageDrawer-c1b5f019.js";import{c as te}from"./index-f8e1d059.js";const Pe=$("Cancel"),Se=$("Save"),$e=L({name:"UserDrawer"}),Ne=L({...$e,setup(y,{expose:u}){const N=i=>{c.value=i,l.value=!0},w=Z({name:[{required:!0,message:"Please upload the component name",trigger:"change"}],description:[{required:!1,message:"Please fill in the description",trigger:"change"}],parent:[{required:!0,message:"Please select parent",trigger:"change"}]}),p={value:"id",label:"name",emitPath:!1},l=m(!1),c=m({isView:!1,title:""}),q=m(),U=()=>{q.value.validate(async i=>{if(q.value,C.value,c.value.rowData,!!i)try{await c.value.apiUrl(c.value.rowData),A.success({message:`${c.value.title} component success!`}),c.value.updateTable(),l.value=!1}catch(s){}})},C=m();return ee(l,i=>{i&&ie().then(s=>{s&&(C.value=s.data)})}),u({acceptParams:N}),(i,s)=>{const g=n("el-input"),b=n("el-form-item"),F=n("el-tree-select"),T=n("el-form"),k=n("el-button"),x=n("el-drawer"),M=ne("loading");return _(),S(x,{modelValue:l.value,"onUpdate:modelValue":s[4]||(s[4]=d=>l.value=d),"destroy-on-close":!0,size:"600px",title:`${c.value.title} Component Category`},{footer:t(()=>[e(k,{onClick:s[3]||(s[3]=d=>l.value=!1)},{default:t(()=>[Pe]),_:1}),O(e(k,{type:"primary",onClick:U},{default:t(()=>[Se]),_:1},512),[[se,!c.value.isView]])]),default:t(()=>[e(T,{ref_key:"ruleFormRef",ref:q,rules:w,disabled:c.value.isView,model:c.value.rowData,"label-width":"130px","label-suffix":" :","append-to-body":!0},{default:t(()=>[e(b,{label:"Name",prop:"name"},{default:t(()=>[e(g,{modelValue:c.value.rowData.name,"onUpdate:modelValue":s[0]||(s[0]=d=>c.value.rowData.name=d),placeholder:"Please fill in the component name",clearable:""},null,8,["modelValue"])]),_:1}),e(b,{label:"Description",prop:"description"},{default:t(()=>[e(g,{modelValue:c.value.rowData.description,"onUpdate:modelValue":s[1]||(s[1]=d=>c.value.rowData.description=d),placeholder:"Please fill in the component description",clearable:"",rows:4,type:"textarea",autosize:""},null,8,["modelValue"])]),_:1}),O((_(),S(b,{label:"Parent",prop:"parent"},{default:t(()=>[e(F,{modelValue:c.value.rowData.parent,"onUpdate:modelValue":s[2]||(s[2]=d=>c.value.rowData.parent=d),multiple:!1,data:C.value,props:p,clearable:"","render-after-expand":!1,checkStrictly:!0,"value-key":"id"},null,8,["modelValue","data"])]),_:1})),[[M,C.value===void 0]])]),_:1},8,["rules","disabled","model"])]),_:1},8,["modelValue","title"])}}}),Ue=async()=>{let u=(await te.records.getList("config")).items.find(p=>p.category==="octopart");const N=u==null?void 0:u.value.id,w=u==null?void 0:u.value.secret;return{id:N,secret:w}},xe=async()=>{let y=await Ue(),u=await te.send("/api/octopart/connect/token",{method:"POST",body:`grant_type=client_credentials&client_id=${y.id}&client_secret=${y.secret}`,headers:{"Content-Type":"application/x-www-form-urlencoded"}});return"error"in u?(A.error(`Octopart Token Error: ${u.error}`),""):u.access_token},qe=async()=>await xe(),Fe=async y=>{let u=await qe();return(await te.send("/api/octopart/graphql",{method:"POST",body:y,headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}})).data},Te=async y=>{let u=await Fe({query:`query Search($mpn: String!) {
              supSearchMpn(q: $mpn, limit: 2) {
                results {
                  part {
                    mpn
                    shortDescription
                    descriptions {
                      text
                      creditString
                      creditUrl
                    }
                    manufacturer {
                      name
                    }
                    category {
                      name
                      path
                    }
                    specs {
                      attribute {
                        name
                      }
                      value
                      units
                    }
                  }
                }
              }
            }`,variables:{mpn:y}});return u.supSearchMpn.results&&u.supSearchMpn.results.length>0&&u.supSearchMpn.results[0].part,u.supSearchMpn},Me={class:"form-item-with-buttons"},Re=$("Cancel"),Oe={style:{margin:"4%"}},Le=$("Import"),ze=D("div",null,"Description",-1),Be=D("div",null,"Category",-1),Ee=D("h3",null,"Attributes",-1),je=L({name:"UserDrawer"}),Ae=L({...je,setup(y,{expose:u}){const N=Z({mpn:[{required:!0,message:"Please input the MPN",trigger:"change"}]}),w=m(!1),p=m({isView:!1,title:""}),l=i=>{p.value=i,w.value=!0,U.value=[],C()},c=m(),q=i=>{p.value.rowData,c.value.validate(async s=>{if(!!s)try{let g={mpn:i.mpn,manufacturer:i.manufacturer.name,specs:i.specs,description:i.shortDescription};p.value.updateTable(g),w.value=!1}catch(g){A.error(String(g))}})},U=m([]),C=async()=>{var i;U.value=(await Te(((i=p.value.rowData)==null?void 0:i.mpn)||"")).results};return ee(w,i=>{}),u({acceptParams:l}),(i,s)=>{const g=n("el-input"),b=n("el-button"),F=n("el-space"),T=n("el-form-item"),k=n("el-form"),x=n("el-descriptions-item"),M=n("el-descriptions"),d=n("el-table-column"),E=n("el-table"),j=n("el-drawer");return _(),B("div",null,[e(j,{modelValue:w.value,"onUpdate:modelValue":s[2]||(s[2]=v=>w.value=v),"destroy-on-close":!0,size:"600px",title:`${p.value.title} Octopart Component`},{footer:t(()=>[e(b,{onClick:s[1]||(s[1]=v=>w.value=!1)},{default:t(()=>[Re]),_:1})]),default:t(()=>[e(k,{ref_key:"ruleFormRef",ref:c,rules:N,disabled:p.value.isView,model:p.value.rowData,"label-width":"80px","label-suffix":" :","append-to-body":!0},{default:t(()=>[e(T,{label:"MPN",prop:"mpn"},{default:t(()=>[D("div",Me,[e(F,null,{default:t(()=>[e(g,{modelValue:p.value.rowData.mpn,"onUpdate:modelValue":s[0]||(s[0]=v=>p.value.rowData.mpn=v),placeholder:"Please fill in the component name",clearable:""},null,8,["modelValue"]),e(b,{icon:P(ue),onClick:C},null,8,["icon"])]),_:1})])]),_:1})]),_:1},8,["rules","disabled","model"]),e(E,{data:U.value,border:!0,style:{width:"100%"}},{default:t(()=>[e(d,{type:"expand"},{default:t(v=>[D("div",Oe,[e(M,{title:"Summary",column:1,border:"",direction:"vertical"},{extra:t(()=>[e(b,{type:"primary",onClick:I=>q(v.row.part)},{default:t(()=>[Le]),_:2},1032,["onClick"])]),default:t(()=>[e(x,null,{label:t(()=>[ze]),default:t(()=>[$(" "+J(v.row.part.shortDescription),1)]),_:2},1024),v.row.part.category?(_(),S(x,{key:0},{label:t(()=>[Be]),default:t(()=>[$(" "+J(v.row.part.category.name)+" ("+J(v.row.part.category.path)+") ",1)]),_:2},1024)):ve("",!0)]),_:2},1024),Ee,e(E,{data:v.row.part.specs,border:!0},{default:t(()=>[e(d,{label:"Attribute",prop:"attribute.name"}),e(d,{label:"Value",prop:"value"}),e(d,{label:"Value",prop:"units"})]),_:2},1032,["data"])])]),_:1}),e(d,{label:"MPN",prop:"part.mpn",width:"140"}),e(d,{label:"Description",prop:"part.shortDescription"})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}}}),Ie={class:"form-item-with-buttons"},Xe={class:"form-item-with-buttons"},Ge={class:"form-item-with-buttons"},He={class:"form-item-with-buttons"},Je={class:"form-item-with-buttons"},Ke=$("New spec"),Qe=$("Cancel"),We=$("Save"),Ye=L({name:"ComponentDrawer"}),Ze=L({...Ye,setup(y,{expose:u}){const N=Z({mpn:[{required:!0,message:"Please upload the component name",trigger:"change"}],description:[{required:!1,message:"Please enter component description",trigger:"change"}],manufacturer:[{required:!1,message:"Please enter component manufacturer",trigger:"change"}],footprint:[{required:!1,message:"Please fill in the footprint",trigger:"change"}],stock:[{required:!0,message:"Please fill in the stock qty",trigger:"change"}],storage_location:[{required:!1,message:"Please select location",trigger:"change"}],category:[{required:!1,message:"Please select category",trigger:"change"}],ipn:[{required:!1,message:"Please fill in IPN",trigger:"change"}]}),w={value:"id",label:"name",emitPath:!1},p=m(!1),l=m({isView:!1,title:""}),c=o=>{l.value=o,p.value=!0},q=o=>{De(l.value.rowData,o)},U=m(),C=()=>{U.value.validate(async o=>{if(!!o)try{await l.value.apiUrl(l.value.rowData),A.success({message:`${l.value.title} component success!`}),l.value.updateTable(),p.value=!1}catch(a){}})},i=(o,a)=>a.name.toLowerCase().includes(o.toLowerCase()),s=()=>{var o,a;l.value.rowData&&typeof((o=l.value.rowData)==null?void 0:o.specs)!="object"&&(l.value.rowData.specs=[]),(a=l.value.rowData)==null||a.specs.push({attribute:{name:"",shortname:"",group:""},value:"",units:""})},g=o=>{var a;(a=l.value.rowData)==null||a.specs.splice(o,1)},b=m(),F=m(),T=m(),k=()=>ie().then(o=>b.value=o.data),x=()=>be().then(o=>F.value=o.data),M=()=>he().then(o=>T.value=o.data);ee(p,o=>{o&&(k(),x(),M())});const d=m(),E=(o,a={})=>{let f={title:o,rowData:{...a},isView:o==="View",apiUrl:o==="New"?re:"",updateTable:M};d.value.acceptParams(f)},j=m(),v=(o,a={})=>{let f={title:o,rowData:{...a},isView:o==="View",apiUrl:o==="New"?Ve:"",updateTable:x};j.value.acceptParams(f)},I=m(),ce=(o,a={})=>{let f={title:o,rowData:{...a},isView:o==="View",apiUrl:o==="New"?ye:"",updateTable:k};I.value.acceptParams(f)},ae=m(),pe=(o,a={})=>{let f={title:o,rowData:{...a},isView:o==="View",apiUrl:o==="New"?re:"",updateTable:q};ae.value.acceptParams(f)};return u({acceptParams:c}),(o,a)=>{const f=n("el-input"),V=n("el-button"),z=n("el-space"),h=n("el-form-item"),de=n("el-input-number"),le=n("el-option"),oe=n("el-select"),X=n("el-button-group"),me=n("el-tree-select"),fe=n("el-form"),_e=n("el-drawer"),G=ne("loading");return _(),B("div",null,[e(_e,{modelValue:p.value,"onUpdate:modelValue":a[13]||(a[13]=r=>p.value=r),"destroy-on-close":!0,size:"600px",title:`${l.value.title} Component`},{footer:t(()=>[e(V,{onClick:a[12]||(a[12]=r=>p.value=!1)},{default:t(()=>[Qe]),_:1}),O(e(V,{type:"primary",onClick:C},{default:t(()=>[We]),_:1},512),[[se,!l.value.isView]])]),default:t(()=>[e(fe,{ref_key:"ruleFormRef",ref:U,rules:N,disabled:l.value.isView,model:l.value.rowData,"label-width":"130px","label-suffix":" :","append-to-body":!0},{default:t(()=>[e(h,{label:"MPN",prop:"mpn"},{default:t(()=>[D("div",Ie,[e(z,null,{default:t(()=>[e(f,{modelValue:l.value.rowData.mpn,"onUpdate:modelValue":a[0]||(a[0]=r=>l.value.rowData.mpn=r),placeholder:"Please fill in the component name",clearable:""},null,8,["modelValue"]),e(V,{icon:P(ue),onClick:a[1]||(a[1]=r=>pe("New",l.value.rowData))},null,8,["icon"])]),_:1})])]),_:1}),e(h,{label:"Manufacturer",prop:"manufacturer"},{default:t(()=>[e(f,{modelValue:l.value.rowData.manufacturer,"onUpdate:modelValue":a[2]||(a[2]=r=>l.value.rowData.manufacturer=r),placeholder:"Please fill in the component manufacturer",clearable:"",rows:4,type:"textarea",autosize:""},null,8,["modelValue"])]),_:1}),e(h,{label:"Description",prop:"description"},{default:t(()=>[e(f,{modelValue:l.value.rowData.description,"onUpdate:modelValue":a[3]||(a[3]=r=>l.value.rowData.description=r),placeholder:"Please fill in the component description",clearable:"",rows:4,type:"textarea",autosize:""},null,8,["modelValue"])]),_:1}),e(h,{label:"Stock",prop:"stock"},{default:t(()=>[e(de,{modelValue:l.value.rowData.stock,"onUpdate:modelValue":a[4]||(a[4]=r=>l.value.rowData.stock=r)},null,8,["modelValue"])]),_:1}),O((_(),S(h,{label:"Footprint",prop:"footprint"},{default:t(()=>[D("div",Xe,[e(z,null,{default:t(()=>[e(oe,{modelValue:l.value.rowData.footprint,"onUpdate:modelValue":a[5]||(a[5]=r=>l.value.rowData.footprint=r),placeholder:"",clearable:"",filterable:"",style:{width:"max-content"}},{default:t(()=>[(_(!0),B(K,null,Q(T.value,r=>(_(),S(le,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(X,null,{default:t(()=>[e(V,{icon:P(W),onClick:k},null,8,["icon"]),e(V,{icon:P(Y),onClick:a[6]||(a[6]=r=>E("New"))},null,8,["icon"])]),_:1})]),_:1})])]),_:1})),[[G,T.value===void 0]]),O((_(),S(h,{label:"Category",prop:"category"},{default:t(()=>[D("div",Ge,[e(z,null,{default:t(()=>[e(me,{modelValue:l.value.rowData.category,"onUpdate:modelValue":a[7]||(a[7]=r=>l.value.rowData.category=r),multiple:!1,data:b.value,props:w,clearable:"","render-after-expand":!1,checkStrictly:!0,filterable:"","filter-node-method":i},null,8,["modelValue","data"]),e(X,null,{default:t(()=>[e(V,{icon:P(W),onClick:k},null,8,["icon"]),e(V,{icon:P(Y),onClick:a[8]||(a[8]=r=>ce("New"))},null,8,["icon"])]),_:1})]),_:1})])]),_:1})),[[G,b.value===void 0]]),O((_(),S(h,{label:"Storage Location",prop:"storage_location"},{default:t(()=>[D("div",He,[e(z,null,{default:t(()=>[e(oe,{modelValue:l.value.rowData.storage_location,"onUpdate:modelValue":a[9]||(a[9]=r=>l.value.rowData.storage_location=r),placeholder:"",clearable:"",filterable:""},{default:t(()=>[(_(!0),B(K,null,Q(F.value,r=>(_(),S(le,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(X,null,{default:t(()=>[e(V,{icon:P(W),onClick:x},null,8,["icon"]),e(V,{icon:P(Y),onClick:a[10]||(a[10]=r=>v("New"))},null,8,["icon"])]),_:1})]),_:1})])]),_:1})),[[G,F.value===void 0]]),e(h,{label:"IPN",prop:"ipn"},{default:t(()=>[e(f,{modelValue:l.value.rowData.ipn,"onUpdate:modelValue":a[11]||(a[11]=r=>l.value.rowData.ipn=r),placeholder:"Internal Part Number",clearable:""},null,8,["modelValue"])]),_:1}),(_(!0),B(K,null,Q(l.value.rowData.specs,(r,H)=>(_(),S(h,{key:H,label:"Spec",prop:H+".value"},{default:t(()=>[e(f,{style:{"margin-bottom":"6px"},modelValue:r.attribute.name,"onUpdate:modelValue":R=>r.attribute.name=R,placeholder:"Attribute"},null,8,["modelValue","onUpdate:modelValue"]),D("div",Je,[e(z,null,{default:t(()=>[e(f,{modelValue:r.value,"onUpdate:modelValue":R=>r.value=R,placeholder:"Value"},null,8,["modelValue","onUpdate:modelValue"]),e(f,{modelValue:r.units,"onUpdate:modelValue":R=>r.units=R,placeholder:"Units"},null,8,["modelValue","onUpdate:modelValue"]),e(V,{type:"danger",icon:P(we),onClick:ge(R=>g(H),["prevent"])},null,8,["icon","onClick"])]),_:2},1024)])]),_:2},1032,["prop"]))),128)),e(h,null,{default:t(()=>[e(V,{onClick:s},{default:t(()=>[Ke]),_:1})]),_:1})]),_:1},8,["rules","disabled","model"])]),_:1},8,["modelValue","title"]),e(Ce,{ref_key:"drawerRefNestedFootprint",ref:d},null,512),e(ke,{ref_key:"drawerRefNestedStorage",ref:j},null,512),e(Ne,{ref_key:"drawerRefNestedComponentCategory",ref:I},null,512),e(Ae,{ref_key:"drawerRefNestedOctopartComponent",ref:ae},null,512)])}}});var nt=Ze;export{nt as C,Ne as _};
