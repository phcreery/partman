import{a6 as L}from"./index-39a2cc13.js";import{c as a,t as w}from"./index-9c5b8b05.js";import{n as T}from"./util-bb5d7d1d.js";var C={};(function(t){var e=L&&L.__assign||function(){return(e=Object.assign||function(l){for(var c,d=1,s=arguments.length;d<s;d++)for(var p in c=arguments[d])Object.prototype.hasOwnProperty.call(c,p)&&(l[p]=c[p]);return l}).apply(this,arguments)},r=(Object.defineProperty(t,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(t.countNodes=t.arrayToTree=void 0)},nestedIds:!0,assign:!1});function n(l,c){c===void 0&&(c={});for(var d,s=e(e({},r),c),p=[],u={},y=s.throwIfOrphans?new Set:null,h=0,P=l;h<P.length;h++){var f=P[h],g=s.nestedIds?i(f,s.id):f[s.id],m=s.nestedIds?i(f,s.parentId):f[s.parentId];if(s.rootParentIds[g])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(g,'", `rootParentIds`: ').concat(Object.keys(s.rootParentIds).map(function(F){return'"'.concat(F,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(u,g)||(u[g]=((d={})[s.childrenField]=[],d)),y&&y.delete(g),s.dataField?u[g][s.dataField]=f:s.assign?u[g]=Object.assign(f,((d={})[s.childrenField]=u[g][s.childrenField],d)):u[g]=e(e({},f),((f={})[s.childrenField]=u[g][s.childrenField],f)),f=u[g],m==null||s.rootParentIds[m]?p.push(f):(Object.prototype.hasOwnProperty.call(u,m)||(u[m]=((g={})[s.childrenField]=[],g),y&&y.add(m)),u[m][s.childrenField].push(f))}if(y!=null&&y.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(y),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(s.throwIfOrphans&&o(p,s.childrenField)<Object.keys(u).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return p}function o(l,c){return l.reduce(function(d,s){return d+1+(s[c]&&o(s[c],c))},0)}function i(l,c){return c.split(".").reduce(function(d,s){return d&&d[s]},l)}t.arrayToTree=n,t.countNodes=o})(C);const j=t=>{let e=Object.keys(t),r=[];for(const o of e)if(o==="created"||o==="updated")r.push(`${o}>='${t[o][0]}' && ${o}<='${t[o][1]}'`);else if(typeof t[o]=="object"){let i=[];Object.keys(t[o]).forEach(l=>{i.push(`${o}~'${t[o][l]}'`)}),i.length>0&&r.push(`(${i.join(" || ")})`)}else r.push(`${o}~'${t[o]}'`);return r.join(" && ")},_=(t,e,r="id",n="parent",o=[])=>{const i=t.find(c=>c[r]===e);o.push(i.name);const l=t.find(c=>c[r]===i[n]);return l?_(t,l[r],r,n,o):o.reverse().join(" \u25B8 ")},b=async t=>{var r,n;return{data:await a.records.getList("components",t.page,t.perPage,{filter:t.filter?j(t.filter):"",sort:(r=t.sort)!=null?r:"",expand:(n=t.expand)!=null?n:"",$autoCancel:!1})}},A=async t=>(await b({page:1,perPage:999,filter:t.filter,expand:"",sort:""})).data.items,q=async t=>({data:await a.records.create("components",t)}),k=async t=>({data:await a.records.update("components",t.id,t)}),B=async t=>{for(const e of t.ids)await a.records.delete("components",e);return!0},z=async()=>{let[t,e]=await w(()=>a.records.getList("components",1,99999,{$autoCancel:!1}));return{data:t.items}},G=async t=>{for(let e of t.getAll("file")){let r=e;if(r.type==="text/csv"){let o=(await r.text()).split(`
`);for(let i=1;i<o.length;i++){let c=o[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);c=c||[];let d={category:"",manufacturer:c[1],mpn:c[2],description:c[3],stock:Number(c[4]),ipn:"",storage_location:"",comment:"",footprint:"",specs:[]};if(!d.mpn)continue;let p=(await I()).data.find(h=>h.name===c[6]);d.storage_location=p?p.id:(await U({name:c[6],description:"",category:""})).data.id;let y=(await O()).data.find(h=>h.name===c[0]);d.category=y?y.id:(await x({name:c[0],description:"",parent:""})).data.id,await q(d)}}}},x=async t=>({data:await a.records.create("component_categories",t)}),H=async t=>({data:await a.records.update("component_categories",t.id,t)}),M=async t=>{for(const e of t.ids)await a.records.delete("component_categories",e);return!0},O=async()=>{let[t,e]=await w(()=>a.records.getList("component_categories",1,99999,{$autoCancel:!1}));return t.items.forEach(r=>{r._fullName=_(t.items,r.id)}),{data:t.items}},V=async()=>{let[t,e]=await w(()=>a.records.getList("component_categories",1,99999,{$autoCancel:!1}));return{data:C.arrayToTree(t.items,{id:"id",parentId:"parent",dataField:null})}},J=async t=>{var r,n;return{data:await a.records.getList("footprints",t.page,t.perPage,{filter:t.filter?j(t.filter):"",sort:(r=t.sort)!=null?r:"",expand:(n=t.expand)!=null?n:""})}},K=async()=>({data:(await a.records.getList("footprints",1,99999,{})).items}),Q=async t=>({data:await a.records.create("footprints",t)}),W=async t=>({data:await a.records.update("footprints",t.id,t)}),X=async t=>{for(const e of t.ids)await a.records.delete("footprints",e);return!0},Y=async t=>({data:await a.records.create("footprint_categories",t)}),Z=async t=>({data:await a.records.update("footprint_categories",t.id,t)}),R=async t=>{for(const e of t.ids)await a.records.delete("footprint_categories",e);return!0},tt=async()=>{let[t,e]=await w(()=>a.records.getList("footprint_categories",1,99999,{$autoCancel:!1}));return e?!1:(t.items.forEach(r=>{r._fullName=_(t.items,r.id)}),{data:t.items})},et=async()=>{let[t,e]=await w(()=>a.records.getList("footprint_categories",1,99999,{$autoCancel:!1}));return e?!1:{data:C.arrayToTree(t.items,{id:"id",parentId:"parent",dataField:null})}},I=async()=>({data:(await a.records.getList("storage_locations",1,99999,{$autoCancel:!1})).items}),rt=async t=>{var r,n;return{data:await a.records.getList("storage_locations",t.page,t.perPage,{filter:t.filter?j(t.filter):"",sort:(r=t.sort)!=null?r:"",expand:(n=t.expand)!=null?n:""})}},U=async t=>({data:await a.records.create("storage_locations",t)}),at=async t=>({data:await a.records.update("storage_locations",t.id,t)}),ot=async t=>{for(const e of t.ids)await a.records.delete("storage_locations",e);return!0},nt=async()=>{let t=await I(),e=await E();return t.data.forEach(r=>{r.parent=r.category}),e.data.push(...t.data),e.data.forEach(r=>{r._fullName=_(e.data,r.id)}),{data:e.data}},$=async()=>{let t=await I(),e=await E();return t.data.forEach(n=>{n.parent=n.category,n.disabled=!1}),e.data.forEach(n=>{n.disabled=!0}),e.data.push(...t.data),{data:C.arrayToTree(e.data,{id:"id",parentId:"parent",dataField:null})}},st=async t=>({data:await a.records.create("storage_categories",t)}),ct=async t=>({data:await a.records.update("storage_categories",t.id,t)}),it=async t=>{for(const e of t.ids)await a.records.delete("storage_categories",e);return!0},E=async()=>{let[t,e]=await w(()=>a.records.getList("storage_categories",1,99999,{$autoCancel:!1}));return t.items.forEach(r=>{r._fullName=_(t.items,r.id)}),{data:t.items}},dt=async()=>{let[t,e]=await w(()=>a.records.getList("storage_categories",1,99999,{$autoCancel:!1}));return e?!1:{data:C.arrayToTree(t.items,{id:"id",parentId:"parent",dataField:null})}},lt=async()=>({data:(await a.records.getList("projects",1,99999,{})).items}),ut=async t=>({data:await a.records.create("projects",t)}),pt=async t=>({data:await a.records.update("projects",t.id,t)}),gt=async t=>{for(const e of t.ids)await a.records.delete("projects",e);return!0},v=async t=>{var i,l;if(t.projectID==="")return{data:{}};let e=await a.records.getOne("projects",t.projectID,{});if(typeof e.quantity!="object"||e.quantity===null||e.quantity.length===0)return{data:{}};let r={id:{...e.quantity.map(c=>c.id)}},n=t.filter;T(n,r);let o=await a.records.getList("components",1,99999,{filter:j(r),sort:(i=t.sort)!=null?i:"",expand:(l=t.expand)!=null?l:""});return await o.items.forEach(function(c,d,s){var p;s[d]._quantityUsed=Number((p=e.quantity.find(u=>u.id===c.id))==null?void 0:p.quantity),s[d]._ofProjectID=e.id}),{data:o}},ft=async t=>{var r;return(await v({page:1,perPage:999,filter:t.filter,expand:"",sort:"",projectID:(r=t.projectID)!=null?r:""})).data.items},yt=async t=>{var n;let e=await a.records.getOne("projects",t._ofProjectID,{});return typeof e.quantity=="object"&&e.quantity!==null&&Array.isArray(e.quantity)?((n=e.quantity)==null?void 0:n.findIndex(i=>i.id==t.id))===-1&&e.quantity.push({id:t.id,quantity:t._quantityUsed}):e.quantity=[{id:t.id,quantity:t._quantityUsed}],{data:await a.records.update("projects",t._ofProjectID,e)}},ht=async t=>{let e=await a.records.getOne("projects",t._ofProjectID,{});return e.quantity[e.quantity.findIndex(n=>n.id==t.id)]={id:t.id,quantity:t._quantityUsed},{data:await a.records.update("projects",t._ofProjectID,e)}},wt=async t=>{let e=await a.records.getOne("projects",t.projectID,{});for(const n of t.ids){let o=e.quantity.findIndex(i=>i.id==n);o!==-1&&e.quantity.splice(o,1)}return{data:await a.records.update("projects",t.projectID,e)}},mt=async t=>{var r,n;return{data:await a.records.getList("profiles",t.page,t.perPage,{filter:t.filter?j(t.filter):"",sort:(r=t.sort)!=null?r:"",expand:(n=t.expand)!=null?n:""})}},Ct=async t=>({data:await a.records.create("profiles",t)}),jt=async t=>({data:await a.records.update("profiles",t.id,t)}),_t=async t=>{for(const e of t.ids)await a.records.delete("profiles",e);return!0},It=async t=>{let r=(await a.records.getList("config")).items.find(n=>n.category===t.category);return{data:r==null?void 0:r.value}},Pt=async t=>{let r=(await a.records.getList("config")).items.find(o=>o.category===t.category);return r?{data:await a.records.update("config",r==null?void 0:r.id,t)}:void 0},Lt=async()=>{let t=await a.send("/api/dashboard/info",{}),e=await $(),r=t.data.components;async function n(o){o.children&&o.children.length!==0?o.children.forEach(i=>n(i)):o.value=r.filter(i=>i.storage_location===o.id).length}for(const o of e.data)await n(o);return t.data.storageLocationsTree=e.data,t.data,{data:t.data}};export{A,G as B,z as C,lt as D,v as E,wt as F,ft as G,yt as H,ht as I,ut as J,pt as K,gt as L,It as M,Pt as N,rt as O,E as P,at as Q,ct as R,ot as S,it as T,mt as U,Ct as V,jt as W,_t as X,b as a,O as b,k as c,x as d,H as e,B as f,V as g,M as h,$ as i,K as j,Q as k,U as l,et as m,Y as n,dt as o,q as p,st as q,J as r,tt as s,W as t,Z as u,X as v,R as w,Lt as x,I as y,nt as z};
